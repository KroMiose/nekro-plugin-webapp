# WebApp 快速部署插件

> 🚀 **智能体群协作系统** - AI 自主组建协作团队，动态创建专业 Agent，自动完成从代码编写到审查部署的全流程

## ✨ 功能特性

### ⚡ 异步工作架构

- **主对话不阻塞**：Agent 集群在后台独立工作，用户与 NekroAgent 主框架的交互完全不受影响
- **实时状态感知**：主 Agent 通过提示词注入实时查看子 Agent 工作进度
- **双向通信**：用户可以随时发送反馈补充，Agent 完成后自动通知
- **会话隔离**：每个会话的 Agent 集群互相独立，互不干扰

### 🤖 智能体群动态协作

- **首席架构师核心**：Architect Agent 负责系统设计和核心编码
- **按需创建子 Agent**：在面对复杂任务时动态召集 Engineer/Creator
- **智能审查迭代**：Reviewer 审查失败后反馈给 Architect 组织修复
- **VFS 共享协作**：所有 Agent 读写同一虚拟文件系统

### 🚀 核心功能

- **AI 一键部署**：AI 自动将生成的代码编译并部署为在线网页
- **全球加速**：基于 Cloudflare Workers，享受全球 CDN 加速
- **实时编译**：本地 esbuild 编译，自动生成 Import Map
- **权限分离设计**：管理密钥和创建页面密钥分离，安全可控，便捷共享

### 🧠 智能模型路由

- **难度评估**：自动评估任务难度 (1-5)
- **模型选择**：低难度用快速模型，高难度用高级模型
- **成本优化**：平衡效果与开销

---

## 🎯 运行原理

### 多层级智能体自动编排

当用户需要创建网页时，系统会自动派遣**架构师智能体**，它会评估任务复杂度并**按需动态创建子智能体团队**。子智能体还可以**继续嵌套创建更多层级**，形成完整的协作树：

```
用户：帮我创建一个实时地震监测大屏，展示全球最近 24 小时的地震数据

AI：✅ 已派遣助手 [A0001] 处理任务
📝 实时地震监测数据大屏
📊 难度: 🔴困难 (4/5)

🤖 架构师 A0001 正在分析需求，评估是否需要召集子 Agent...
```

### 智能体层级树可视化

通过 `webapp_list` 命令可以实时查看**多层级智能体的组织结构和工作状态**：

```
🌐 WebApp Agent 协作状态
━━━━━━━━━━━━━━━━━━━━━━━━━
📊 总计 4 个 · 💻运行中 2 · 💬等待 0 · 🏗️层级 3

└─ [架构师] A0001
      💻 运行中 · ⚡128/s · 📝4.2k字 · ⏱️2m35s · ⭐4
      🤖 2 个活跃子任务
   ├─ [工程师] A0001-E1
   │     💻 运行中 · ⚡96/s · 📝1.8k字 · ⏱️1m20s
   │     🤖 1 个活跃子任务
   │  └─ [工程师] A0001-E1-E1
   │        💻 运行中 · ⚡64/s · 📝0.6k字 · ⏱️28s
   └─ [策划] A0001-C1
         ✅ 已完成 · 🏁2.1k字 · ⏱️45s

━━━━━━━━━━━━━━━━━━━━━━━━━
💡 提示: wa_list -v 查看详情 · wa_info <ID> 查看单个
```

### 单个智能体详情

通过 `webapp_info <ID>` 查看任意智能体的详细状态和完整任务树：

```
🌐 Agent [A0001]
━━━━━━━━━━━━━━━━━━━━━━━━━
💻 状态: 运行中 (65%)
📊 进度: ██████░░░░
⚡ 输出: 4.2k 字 (128/s)
🏗️ 角色: 架构师 (Lv.1)
⏱️ 耗时: 2m35s
🎯 难度: ⭐⭐⭐⭐☆ (4/5)

📝 任务: 创建实时地震监测大屏，展示全球最近24小时的地震数据...

🌳 任务树视图:
  └─👉💻 [架构师] A0001
     ├─  💻 [工程师] A0001-E1
     │  └─  💻 [工程师] A0001-E1-E1
     └─  ✅ [策划] A0001-C1

📄 HTML: 12,580 字符
📦 子产物: A0001-E1, A0001-C1
```

### 任务完成通知

当整个智能体团队协作完成后，AI 会通知用户：

```
[系统] ✅ [WebDev Agent A0001] (成果)
网页已部署完成！
🔗 预览链接: https://your-worker.pages.dev/abc12345
⏱️ 总耗时: 3m28s · 🏗️协作层级: 3 · 🤖参与智能体: 4

如需修改，请向 AI 发送反馈。
```

### 管理员命令

| 命令                   | 说明                              |
| ---------------------- | --------------------------------- |
| `webapp_list`          | 列出活跃智能体层级树              |
| `webapp_list -v`       | 详细树状展示（含任务摘要）        |
| `webapp_info <ID>`     | 查看智能体详情及完整任务树        |
| `webapp_info <ID> -v`  | 完整信息（含消息记录）            |
| `webapp_cancel <ID>`   | 取消指定智能体及其所有子智能体    |
| `webapp_recompile <ID>`| 手动重新编译和部署                |
| `webapp_help`          | 显示帮助                          |

---

## 📦 快速开始

### 第一步：部署 Worker

请查看完整的部署指南：

👉 **[部署文档（DEPLOYMENT.md）](https://github.com/KroMiose/nekro-plugin-webapp/blob/main/DEPLOYMENT.md)**

### 第二步：配置插件

1. 打开 NekroAgent 插件配置页面
2. 找到 **WebApp 快速部署** 插件
3. 填写基础配置：
   - **Worker URL**：你的 Worker 地址
   - **ACCESS_KEY**：访问密钥
   - **WEBDEV_MODEL_GROUP**：网页开发模型组
4. （可选）配置高级模型：
   - **ADVANCED_MODEL_GROUP**：高级模型组
5. 保存配置

### 第三步：创建访问密钥

1. 访问管理界面：[点击跳转](/plugins/KroMiose.nekro_plugin_webapp/)
2. 使用管理密钥登录
3. 在"密钥管理"中创建访问密钥
4. 将访问密钥填入插件配置

✅ **配置完成**！

---

## � 难度评估说明

插件会根据需求描述自动评估任务难度：

| 难度 | 等级    | 描述                 | 示例               |
| ---- | ------- | -------------------- | ------------------ |
| 1-2  | 🟢 简单 | 静态展示页、简单介绍 | 公告页、名片页等   |
| 3    | 🟡 中等 | 响应式布局、基础交互 | 简历页、产品介绍等 |
| 4-5  | 🔴 困难 | 复杂动画、数据可视化 | 游戏、数据大屏等   |

---

## 🔐 密钥说明

### 密钥类型

**管理密钥（Admin Key）**：

- ✅ 拥有完全管理权限
- ❌ 不能用于创建页面
- ⚠️ 不要分享给其他人

**访问密钥（Access Key）**：

- ✅ 用于创建和托管新页面
- ✅ 可以安全分享给可信任的其他 NekroAgent 用户使用
- ❌ 不能管理系统或其他密钥

---

## ❓ 常见问题

<details>
<summary><strong>Q: 高级模型配置有什么作用？</strong></summary>

当配置了 `ADVANCED_MODEL_GROUP` 后：

- 难度 ≥ 阈值的任务会使用高级模型
- 高级模型通常有更强的代码生成能力
- 适合处理复杂的交互、动画、可视化需求

</details>

---

## 📚 相关文档

- [📖 部署指南（DEPLOYMENT.md）](https://github.com/KroMiose/nekro-plugin-webapp/blob/main/DEPLOYMENT.md)
- [💻 开发文档（DEVELOPMENT.md）](https://github.com/KroMiose/nekro-plugin-webapp/blob/main/DEVELOPMENT.md)
- [🌐 Cloudflare Workers 文档](https://developers.cloudflare.com/workers/)

---

## 📄 许可证

MIT License - 详见 [LICENSE](./LICENSE) 文件

---

## 🤝 贡献

欢迎贡献代码、报告问题或提出建议！

- 🐛 [报告 Bug](https://github.com/KroMiose/nekro-plugin-webapp/issues/new)
- 💡 [提出功能建议](https://github.com/KroMiose/nekro-plugin-webapp/issues/new)

---

**Made with ❤️ by NekroAI Team**

如果觉得这个插件有用，欢迎给个 ⭐ Star！
